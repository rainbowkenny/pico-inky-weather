"""
Standalone weather display — Pimoroni Pico Inky Pack (296x128)
UK map embedded as bytes — single file, no external dependencies.
"""
import network, urequests, time, gc
from picographics import PicoGraphics, DISPLAY_INKY_PACK
import jpegdec

SSID     = "ASUS_E8_2G"
PASSWORD = "Bbdd1003"
BLACK = 0
WHITE = 15

WMO = {
    0:"Clear", 1:"Clear", 2:"P.Cloudy", 3:"Overcast",
    45:"Fog", 48:"Icy Fog",
    51:"Drizzle", 53:"Drizzle", 55:"Drizzle",
    61:"Lt Rain", 63:"Rain", 65:"Hvy Rain",
    71:"Lt Snow", 73:"Snow", 75:"Hvy Snow",
    80:"Showers", 81:"Showers", 82:"Showers",
    95:"Thunder", 96:"Thunder", 99:"Thunder",
}

# UK map panel position on display
MAP_X, MAP_Y = 148, 14
MAP_W, MAP_H = 148, 113
MAP_PAD = 6

# Pre-computed dot positions for common UK cities
# (pixel x, pixel y) within the full 296x128 display
CITY_DOTS = {
    "London":      (210, 108),
    "Cambridge":   (224, 101),
    "Oxford":      (197, 103),
    "Birmingham":  (183,  89),
    "Bristol":     (163,  99),
    "Manchester":  (175,  75),
    "Liverpool":   (168,  76),
    "Leeds":       (183,  71),
    "Sheffield":   (183,  76),
    "Newcastle":   (186,  57),
    "Edinburgh":   (172,  38),
    "Glasgow":     (162,  35),
    "Cardiff":     (159, 101),
    "Nottingham":  (189,  83),
    "Leicester":   (191,  88),
    "Norwich":     (220,  93),
    "Ipswich":     (218,  99),
    "Brighton":    (203, 112),
    "Southampton": (193, 110),
    "Exeter":      (157, 107),
    "Plymouth":    (150, 110),
    "Coventry":    (188,  88),
    "Reading":     (199, 106),
    "Milton Keynes": (200, 99),
    "Peterborough": (209, 93),
    "Derby":       (185,  81),
    "Stoke-on-Trent": (177, 80),
    "Aberdeen":    (182,  27),
    "Inverness":   (169,  24),
    "Swindon":     (188, 103),
}

# Fallback: linear interpolation from lat/lon
LON_MIN, LON_MAX = -6.5, 2.1
LAT_MIN, LAT_MAX = 49.8, 60.9

def latlon_to_dot(lat, lon):
    x = MAP_X + MAP_PAD + int((lon - LON_MIN) / (LON_MAX - LON_MIN) * (MAP_W - 2*MAP_PAD))
    y = MAP_Y + MAP_PAD + int((LAT_MAX - lat) / (LAT_MAX - LAT_MIN) * (MAP_H - 2*MAP_PAD))
    x = max(MAP_X + MAP_PAD, min(MAP_X + MAP_W - MAP_PAD, x))
    y = max(MAP_Y + MAP_PAD, min(MAP_Y + MAP_H - MAP_PAD, y))
    return x, y

def connect_wifi():
    wlan = network.WLAN(network.STA_IF)
    wlan.active(True)
    if not wlan.isconnected():
        wlan.connect(SSID, PASSWORD)
        deadline = time.time() + 20
        while not wlan.isconnected() and time.time() < deadline:
            time.sleep(0.5)
    return wlan.isconnected()

def get_location():
    gc.collect()
    r = urequests.get("http://ip-api.com/json/?fields=lat,lon,city", timeout=10)
    d = r.json(); r.close(); gc.collect()
    return float(d["lat"]), float(d["lon"]), d["city"]

def get_weather(lat, lon):
    gc.collect()
    url = ("https://api.open-meteo.com/v1/forecast"
           "?latitude={}&longitude={}"
           "&current_weather=true"
           "&daily=temperature_2m_max,temperature_2m_min,weathercode"
           "&forecast_days=2&timezone=auto").format(lat, lon)
    r = urequests.get(url, timeout=15)
    d = r.json(); r.close(); gc.collect()
    return d

def parse_time(wt):
    try:
        if len(wt) >= 16:
            d = wt[8:10].lstrip("0") or "0"
            m = wt[5:7].lstrip("0") or "0"
            return "{}/{} {}:{}".format(d, m, wt[11:13], wt[14:16])
    except Exception:
        pass
    return "--/-- --:--"

def show_error(display, msg):
    display.set_pen(WHITE); display.clear()
    display.set_pen(BLACK); display.set_font("bitmap8")
    display.text("ERROR", 4, 20, scale=2)
    display.set_font("bitmap6")
    display.text(str(msg)[:42], 4, 55, scale=1)
    display.update()

UK_MAP = (
    b'\xff\xd8\xff\xe0\x00\x10JFIF\x00\x01\x01\x00\x00\x01\x00\x01\x00\x00'
    b'\xff\xdb\x00C\x00\x03\x02\x02\x02\x02\x02\x03\x02\x02\x02\x03\x03\x03\x03\x04'
    b'\x06\x04\x04\x04\x04\x04\x08\x06\x06\x05\x06\t\x08\n\n\t\x08\t\t\n'
    b'\x0c\x0f\x0c\n\x0b\x0e\x0b\t\t\r\x11\r\x0e\x0f\x10\x10\x11\x10\n\x0c'
    b'\x12\x13\x12\x10\x13\x0f\x10\x10\x10\xff\xc0\x00\x0b\x08\x00q\x00\x94\x01\x01'
    b'\x11\x00\xff\xc4\x00\x1f\x00\x00\x01\x05\x01\x01\x01\x01\x01\x01\x00\x00\x00\x00'
    b'\x00\x00\x00\x00\x01\x02\x03\x04\x05\x06\x07\x08\t\n\x0b\xff\xc4\x00\xb5\x10'
    b'\x00\x02\x01\x03\x03\x02\x04\x03\x05\x05\x04\x04\x00\x00\x01}\x01\x02\x03\x00'
    b'\x04\x11\x05\x12!1A\x06\x13Qa\x07"q\x142\x81\x91\xa1\x08'
    b'#B\xb1\xc1\x15R\xd1\xf0$3br\x82\t\n\x16\x17\x18\x19\x1a'
    b"%&'()*456789:CDEFGHI"
    b'JSTUVWXYZcdefghijstu'
    b'vwxyz\x83\x84\x85\x86\x87\x88\x89\x8a\x92\x93\x94\x95\x96\x97\x98'
    b'\x99\x9a\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba'
    b'\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xe1\xe2'
    b'\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xff\xda'
    b'\x00\x08\x01\x01\x00\x00?\x00\xfa\xcf\xf6d\xfd\x99?f\xdd\x7f\xf6m'
    b'\xf8Q\xae\xeb\xbf\xb3\xe7\xc3]GR\xd4|\x0f\xa1]\xde^]\xf8'
    b'N\xc2i\xeeg\x92\xc2\x16\x92Y$h\x8b;\xb3\x12\xc5\x89$\x92'
    b'I\xafK\xff\x00\x86N\xfd\x96?\xe8\xda~\x15\x7f\xe1\x1b\xa7\x7f\xf1'
    b'\x9a?\xe1\x93\xbfe\x8f\xfa6\x9f\x85_\xf8F\xe9\xdf\xfcf\x8f\xf8'
    b'd\xef\xd9c\xfe\x8d\xa7\xe1W\xfe\x11\xbaw\xff\x00\x19\xa3\xfe\x19;'
    b'\xf6X\xff\x00\xa3i\xf8U\xff\x00\x84n\x9d\xff\x00\xc6h\xff\x00\x86'
    b'N\xfd\x96?\xe8\xda~\x15\x7f\xe1\x1b\xa7\x7f\xf1\x9a?\xe1\x93\xbfe'
    b'\x8f\xfa6\x9f\x85_\xf8F\xe9\xdf\xfcf\x8f\xf8d\xef\xd9c\xfe\x8d'
    b'\xa7\xe1W\xfe\x11\xbaw\xff\x00\x19\xa3\xfe\x19;\xf6X\xff\x00\xa3i'
    b'\xf8U\xff\x00\x84n\x9d\xff\x00\xc6h\xff\x00\x86N\xfd\x96?\xe8\xda'
    b'~\x15\x7f\xe1\x1b\xa7\x7f\xf1\x9a?\xe1\x93\xbfe\x8f\xfa6\x9f\x85_'
    b'\xf8F\xe9\xdf\xfcf\x8f\xf8d\xef\xd9c\xfe\x8d\xa7\xe1W\xfe\x11\xba'
    b'w\xff\x00\x19\xa3\xfe\x19;\xf6X\xff\x00\xa3i\xf8U\xff\x00\x84n'
    b'\x9d\xff\x00\xc6h\xff\x00\x86N\xfd\x96?\xe8\xda~\x15\x7f\xe1\x1b\xa7'
    b'\x7f\xf1\x9a?\xe1\x93\xbfe\x8f\xfa6\x9f\x85_\xf8F\xe9\xdf\xfcf'
    b'\x8f\xf8d\xef\xd9c\xfe\x8d\xa7\xe1W\xfe\x11\xbaw\xff\x00\x19\xa3\xfe'
    b'\x19;\xf6X\xff\x00\xa3i\xf8U\xff\x00\x84n\x9d\xff\x00\xc6h\xff'
    b'\x00\x86N\xfd\x96?\xe8\xda~\x15\x7f\xe1\x1b\xa7\x7f\xf1\x9a\xfc\x8b\xff'
    b'\x00\x82\xbb|=\xf0\x0f\xc3_\xdaK\xc3z\x17\xc3\x9f\x03\xf8\x7f\xc2'
    b'\xbal\xfe\x07\xb3\xbb\x96\xcfD\xd3!\xb1\x82I\xda\xfe\xfdZV\x8e'
    b'\x15U.U\x11K\x11\x9c"\x8e\xc2\xbf]?d\xef\xf95\x8f\x83'
    b'\x7f\xf6O\xfc=\xff\x00\xa6\xe8+\xd5h\xa2\x8a(\xa2\x8a(\xa2\x8a'
    b"(\xa2\x8a+\xf1[\xfe\x0bW\xff\x00'O\xe1o\xfb'\xf6?\xfa"
    b'q\xd4k\xf5S\xf6N\xff\x00\x93X\xf87\xff\x00d\xff\x00\xc3\xdf'
    b'\xfan\x82\xbdV\x8a(\xa2\x8a(\xa2\x8a(\xa2\x8a(\xa2\xbf\x15\xbf'
    b'\xe0\xb5\x7f\xf2t\xfe\x16\xff\x00\xb2\x7fc\xff\x00\xa7\x1dF\xbfU?'
    b'd\xef\xf95\x8f\x83\x7f\xf6O\xfc=\xff\x00\xa6\xe8+\xd5h\xaf\x03'
    b"\xf1\xe7\xc4mw\xe2'\x8f'\xf0\x17\xc2O\x89\x93h\x9aW\x85\xe0"
    b'\x94\xf8\x93^\xd0c\xb0\xbc\x98j\xc6c\x14ZR=\xcc76\xea'
    b'\xf0\xac72]\xc2\xf1\xac\xd1\x99t\xf2\xac\x16I\x14\xd0\x82\xc3\xe3'
    b'\xc6\x84\xe6\xef@\xfd\xa1\xaf\xb5\x9b\x87\x1e[A\xe3/\x0c\xe9\xb7\xb6'
    b'J\x87\x92\xe8\x9adzt\xc2P@\x01\x9av\x8fk81\xb3\x15'
    b't\x9f\xfbs\xf6\xa7\xff\x00\xa2\x9d\xf0\xab\xff\x00\r\xde\xa3\xff\x00\xcb'
    b'\xba\x86\xe2\x0f\xda\x07\xc4\x1b\x7f\xe1"\xf8\xf7\x0e\x89\xe4g\xc9\xff\x00'
    b"\x84'\xc2v\x96>v\xef\xbd\xf6\x8f\xedF\xd4\xb7\xe3\x0b\xb3\xca\xf2"
    b'q\xbaM\xfefSbAa\xf1\xe3Bsw\xa0~\xd0\xd7\xda\xcd'
    b'\xc3\x8f-\xa0\xf1\x97\x86t\xdb\xdb%C\xc9tM2=:a('
    b' \x00\xcd;G\xb5\x9c\x18\xd9\x8a\xba^\x9b\xf6\x80\xf8\x91\xf0\xfe\xc2'
    b'\xe3[\xf8\xc1\xf0\xe3E\x93\xc3\x1aM\xbb\xc9\xa9x\x8b\xc2\xfa\xd3\xcd'
    b",\x10\xc4\xbb\xa5\xd4'\xd3na\x88\xc1l\xb1\xa4\x924P\\\xde"
    b'N\x87dh\x97\x192\x0f}\xa2\x8a(\xa2\x8a(\xaf\xc5o\xf8-'
    b'_\xfc\x9d?\x85\xbf\xec\x9f\xd8\xff\x00\xe9\xc7Q\xaf\xd5O\xd9;\xfe'
    b'Mc\xe0\xdf\xfd\x93\xff\x00\x0f\x7f\xe9\xba\n\xf5Z\xf9F\xc7B\xf0'
    b'\xcf\xed\x19\x1d\xcf\xc5\x0f\x89\x1aL>(\xf0\xe6\xbdrn\xbc#\xa2'
    b'j\xf9\xbb\xd2\xedteP\x96wb\xcaO\xdc\x1b\x8b\x94\x12^\t'
    b'\xe4\x81n\xa1MA\xadY\xb6\xc5\x83\xe8\xfaf\x99\xa6\xe8\xbam\xa6'
    b'\x8d\xa3i\xf6\xd6\x1a}\x84\x11\xda\xdaZZ\xc4\xb1Co\n(T'
    b'\x8e4P\x15\x11T\x00\x14\x00\x00\x00\n\xb3E\x14Vo\x88\xfcM'
    b'\xe1\xbf\x07h\xd7\x1e#\xf1w\x884\xdd\x0fI\xb4\xd9\xf6\x8b\xfdJ'
    b'\xee;kxw\xb8E\xdf$\x84*\xe5\xd9Td\xf2X\x0e\xa6\xb2'
    b'\xff\x00e/\x88\x9a=\xed\xb6\xa1\xf0\x97\xc3\x0f}\xac\xf8K\xc2\xd6'
    b'\xf0\x7f\xc2\x17\xe2;-6\xe2m\x1e\xe7DH\xa3\x88X\xae\xa8\x13'
    b'\xec\xd776\x93,\xb0\xe1\x1d\x98\xc2 \xde\xf3\\Gx\xc9\xf4%'
    b'\x14QE\x14Q_\x8a\xdf\xf0Z\xbf\xf9:\x7f\x0b\x7f\xd9?\xb1\xff'
    b"\x00\xd3\x8e\xa3_\xaa\x9f\xb2w\xfc\x9a\xc7\xc1\xbf\xfb'\xfe\x1e\xff\x00"
    b'\xd3t\x15\xcd\xfe\xd4\x1e9\xd1\xee\xb4\xf4\xfd\x9fu9\x1fG\x83\xe2'
    b'^\x9f>\x8d}\xaf\xea0\xc9oa\r\xad\xd06\xedeir\xe0'
    b'C>\xadp\xaf"\xc1l\x18\xb2*Kp\xe8\xeb\x12Aq\xb7E'
    b'\x14W7\xf1\x06\xe3\xe2D\x1e\x1b\x9b\xfe\x15V\x93\xe1\xab\xed~M'
    b'\xd1\xc3\xff\x00\t\x0e\xa1=\xa5\x9c\x19\x8d\xf6\xca\xdeD2\xbc\xbbd'
    b'\xf2\xf3\x10\xf2\xf7)o\xde!\x03>Oey\xf1G_!\xbe+'
    b'x\x1f\xe3f\xa3o\x92\x92i^\x10>\x1a\xf0\xd5\x8d\xc4`e\x1a'
    b'IW]\x9fRID\x87qh/\xa1FTDh\xca\xf9\xbeo'
    b'e\xe0\x9d\x7f\xf6i\xf8w\xab\xda\xf8\x97X\xfd\x9c\xbcm\xe1\x9f\x19'
    b'\xd9\x99\x1a\xdbX\xd5|\x19w\xe2\xcdvH\x9d\x1a?5\xf5\x9d?'
    b'\xfbE\xceQ\xa4\x84G-\xd7\x9a\xb1\xa0]\x8b\x11\x8fw\xbd|7'
    b'\xf8\xa9\xe0\xbf\x8b\x1a~\xa7\xa9x*\xefR\x92=\x1bP:]\xfc'
    b':\x96\x8d{\xa5\xdc[]y\x10\xcf\xe5\xbc\x17\x91E(\xccW\x10'
    b'\xb8;v\x91 \xc1<\xd7]E\x14QE\x14W\xe2\xb7\xfc\x16\xaf'
    b'\xfeN\x9f\xc2\xdf\xf6O\xec\x7f\xf4\xe3\xa8\xd7\xea\xa7\xec\x9d\xff\x00&'
    b'\xb1\xf0o\xfe\xc9\xff\x00\x87\xbf\xf4\xdd\x05zV\xad\xa4\xe9Z\xfe\x95'
    b'{\xa1k\xbae\xa6\xa3\xa6\xea6\xf2Z^Y\xdd\xc2\xb3As\x04'
    b'\x8aVH\xa4\x8d\x81WFRT\xa9\x04\x10H5\xe4\xda\x87\xec\xc3'
    b'\xe0\xed%Z\xf7\xe0\xfe\xad\xa9|9\xbe\x8f\x9b{M*g\x97A'
    b'\x00\x0c\xf9-\xa3H\xc6\xd2(^@\xaf)\xb4Kk\x87>f\xdb'
    b'\x88\xdaY\x19\xb9\x1f\x13^|`\xf8G\xa4_\xf8\x93\xe2_\x87\xfc'
    b'?\xe2/\t\xe8\xb6\xf2]\xea^$\xf0\xd5\xc3\xda\\Z\xdbF\x86'
    b'Y\xae\xe7\xd2n\x8byv\xf0\xc6\xb2\x06\xf2/n\xe7r\x88R\x03'
    b'\xe6\x14\x8b\xab\xd35\x085m6\xd3U\xb5\x8e\xe68/`\x8e\xe2'
    b'5\xba\xb5\x92\xdaeWP\xc0I\x0c\xaa\xb2F\xf8<\xa3\xaa\xb2\x9c'
    b'\x82\x01\x04U\x9a(\xa2\xb9\xdb\xa85\xdf\x06\xf8\xbaO\x8a>\t\xb0'
    b'\xfe\xd2\xbf\x9e\xc6\xdfL\xd7tc"!\xd64\xfby&\x92\x15\xb7'
    b'\x92B\x16\x0b\xb8^\xe6\xe5\xa2,\xcb\x0c\xbet\x91LWtW6'
    b"\xbe\xa5\xe0\x0f\x8b\x1f\x0f\xbe'\xc7x<\x17\xe2$\xba\xbc\xd3<\xbf"
    b'\xed\x1d2\xe6\xdek-KN\xf37\xf9_j\xb1\xb8D\xb9\xb6\xf3'
    b'\x04l\xd1\xf9\xb1\xa7\x98\x80:nR\x18\xf5\xd4QE\x14Q_\x8a'
    b'\xdf\xf0Z\xbf\xf9:\x7f\x0b\x7f\xd9?\xb1\xff\x00\xd3\x8e\xa3_\xaa\x9f'
    b"\xb2w\xfc\x9a\xc7\xc1\xbf\xfb'\xfe\x1e\xff\x00\xd3t\x15\xea\xb4W\x8d"
    b'~\xd2\xf6\x1a\xbczW\x85|_\x16\x9b\xab\xeb\xfa\x17\x875\xfb{'
    b'\x8ds\xc3\xfav\x9f=\xfc\xb71I\xfb\xbb{\xc8\xad-\xd1\xa5\xb9'
    b'\x96\xce\xe9\xad\xa7\x08KF\x91-\xc4\xc2).!\xb5h\xf2\xfc#'
    b'\xe3\x9f\x04\xfc@\xd3d\xd6|\x07\xe3\x1d\x0f\xc4\x9a|3\xb5\xac\x97'
    b'zF\xa1\r\xe4)0Uc\x19x\x99\x948WBT\x9c\xe1\x94'
    b'\xf7\x15\xb7E\x14W\t\xf1^\xf7\xe2\x9e\x97i\xa6j\xdf\x0e\xb5\r'
    b'\x16\xde\xc2\xda\xe1\xbf\xb7\xc5\xdf\x87.u\x9b\xb4\xb4+\xc4\xf6\x96\xf6'
    b"\xf7v\xed3F\xc3/\x08-#\xc6\\\xc4\x1eTH'\xab\xa9\xfe"
    b'\xce\x1f\x10>.\xd8\xe8\x9e \xd5~9x\n\xf2\xc9\xe0\xfbF\x93'
    b'\xe2_\tx>\xf2\xc3X\xb4\xb4\xb9T2M\xa4\xea\xa9\xacJm'
    b'\x9eX\x82\x81"\xac\x91\xba\x90$\x8eh\xcbF\xdfLi6W:'
    b'v\x95e\xa7\xdej\xd7z\xa5\xc5\xad\xbcp\xcb}v\xb1,\xf7N'
    b'\xaa\x03M \x85\x12 \xecAb#DL\x93\xb5T`\x0btQ'
    b'E\x14W\xe2\xb7\xfc\x16\xaf\xfeN\x9f\xc2\xdf\xf6O\xec\x7f\xf4\xe3\xa8'
    b'\xd7\xea\xa7\xec\x9d\xff\x00&\xb1\xf0o\xfe\xc9\xff\x00\x87\xbf\xf4\xdd\x05'
    b'z\xad\x14W\x11\xe3\x8f\x82?\x08>%jI\xae\xf8\xe7\xe1\xb7\x87'
    b'\xb5}j\x0baii\xadMa\x18\xd5,\xa3VfO\xb3^\xa8'
    b'\x17\x16\xce\x8e\xee\xe8\xf1H\x8d\x1b\x9d\xe8U\xb9\xae"\xf7\xf6z\xf1'
    b'n\x80K|)\xf8\xd3\xab\xe9\xd6\xf9\t\x1e\x95\xe2\xfbC\xe2[\x1b'
    b'x\xc8\xcb\xb4r\xb4\xb0jO)\x90n\r=\xf4\xc8\xaa\xee\x8b\x18'
    b'_+\xca\xc0\xba\xd5\xfe4x_#\xc6\xdf\x01\xef\xef!E\xfbD'
    b'\xfa\x8f\x835\x9b}f\xce\xda\xdc}\xe2\xf1\xdc\x0b;\xf9fP\xac'
    b'\xc6\x1b{9\xcb)A\x19\x92F1-\xef\t\xfc@\xf0\x97\x8d\xa4'
    b'\xbd\xb4\xd05G:\x8e\x97\xe5\xff\x00h\xe9W\xb6\xb3X\xeaZ\x7f'
    b'\x99\xb8\xc5\xf6\xab+\x84K\x8b\x7f1T\xbay\xb1\xae\xf4\xc3\xae\xe5'
    b' \x9e\x86\x8a\xe0\xaf~\x02\xfc\x1c\xbb\xd5\xae|Im\xf0\xefF\xd1'
    b'\xfcAw<\x97R\xeb\xfa\x14?\xd9:\xc0\x9aBL\xb2.\xa1f'
    b'c\xbaG\x93s\x87e\x90\x17Wum\xca\xec\x0b\xe1\xf8M\x16\x97'
    b' \xbf\xf0\xb7\xc5\x0f\x8aZ6\xa9\x17\xfa\x8b\xe7\xf1\xce\xa7\xab\x08\xb3'
    b'\xc3\x7f\xa2j\x93]Y\xcb\x95,\xbf\xbd\x81\xf6\xee\xdc\xbb]U\xd6'
    b'\xdc:?\xc6\xfd&A\xa8h\xff\x00\xb4\x97\x88\xb5;\xc8\xbf\xd5\xda'
    b'\xf8\x9b\xc3\xfa5\xd6\x9b&x>tV6\xb6W-\x80I_.'
    b'\xe6<8B\xdb\xd44m\xb3\xe1\xdf\xda/\xfe\x11\x03w\xe1\xdf\x8f'
    b'\xab-\x86\xa5gt<\x9f\x10i\x1e\x17\xd4\xc6\x85y`\xd1\xc6\xff'
    b'\x00m\x9ad\x170i\x89\x13\xb4\xf0\xc8.n\xbeQjn\x18\xc7'
    b'\x14\xa8\x17\xd2|\x0b\xf1c\xe1g\xc5\x0f\xb7\x7f\xc2\xb3\xf8\x97\xe1O'
    b'\x16\xff\x00fy_m\xfe\xc2\xd6m\xaf\xfe\xcb\xe6n\xf2\xfc\xdf%'
    b'\xdbf\xef-\xf6\xee\xc6v6:\x1a\xea\xe8\xa2\xbf\x15\xbf\xe0\xb5\x7f'
    b'\xf2t\xfe\x16\xff\x00\xb2\x7fc\xff\x00\xa7\x1dF\xbfU?d\xef\xf9'
    b'5\x8f\x83\x7f\xf6O\xfc=\xff\x00\xa6\xe8+\xd5h\xa2\xbc\xc7\\\xfd'
    b'\xa6\xbe\x00h:\x8d\xf6\x83/\xc5\xaf\x0ejZ\xf6\x9dq%\xa5\xc6'
    b'\x81\xa2]\x8d[Y\x13\xc6\xe5e\x89t\xeb?6\xed\xde2\x18\xc8'
    b'\xab\x11(\xa8\xec\xfbU\x18\x8c\xb7\xfd\xaa\xfe\x19\xca\x8d\x16\x93\xe1\xef'
    b'\x89z\x8d\xf3\x82\xb6\xd6k\xf0\xe7^\xb472\x9f\xb9\x10\x9e\xee\xd2'
    b'+xw6\x17\xcc\x9eX\xe2\\\xe5\xdd\x14\x16\x15?\xe1\xa4|K'
    b'\xff\x00F\xbd\xf1W\xff\x00\x03<3\xff\x00\xcb\x8a\xe4\xa0_\x8a\xfe'
    b',\xf8\xbb\xa7\xfc@\xf1\x8f\x83|!\xe1{+/\x0e_h\xd7i'
    b'\xa2x\x96\xe7S\x9fT\x95\xee\xade\xb43\x89,-F\xcb`\x97'
    b'\xfe^Y\xca\x9b\xe9v\x85\xde\xe5\xbb\xca(\xa2\x8a+\x9b\xf1\x97\xc3'
    b'?\x86\xff\x00\x11~\xc7\xff\x00\x0b\x07\xe1\xf7\x86\xbcO\xfd\x9f\xe6}'
    b'\x93\xfbgI\x82\xf7\xec\xfef\xdd\xfe_\x9a\x8d\xb3v\xc4\xce1\x9d'
    b'\xab\x9e\x82\xa8Yx?\xc7\xde\x0e"o\x86?\x19\xbcMd\x88L'
    b'\x9f\xd9~*\x9eO\x13\xe9\xd3\xca\xc3kI3\xdeI\xfd\xa3\xf71'
    b'\xb68o\xa1\x89]\x15\xf66\xe9V]D\xf8\xeb\xf13\xe1\xe2A'
    b'?\xc6\x0f\x08hZ\xb7\x87\x92\xe2\x0bk\xcf\x15xf\xe9\xed~\xc6'
    b'\xb3L\xaao/4\xdb\xb2V\xd2\xc6\x05v3N\x97\xd7,\xab\x1f'
    b'\x9abT2y>\xfb_\x8a\xdf\xf0Z\xbf\xf9:\x7f\x0b\x7f\xd9?'
    b"\xb1\xff\x00\xd3\x8e\xa3_\xaa\x9f\xb2w\xfc\x9a\xc7\xc1\xbf\xfb'\xfe\x1e"
    b'\xff\x00\xd3t\x15\xea\xb4W5\xe3\xef\x1fh\x7f\x0e\xf45\xd65\x84'
    b'\xb9\xba\x9e\xeau\xb2\xd34\xcb%W\xbc\xd5/\x19Y\x92\xda\xdd\x19'
    b'\x95Y\xca\xa3\xb1fe\x8e8\xe3\x92Y^8\xa3\x92E\xf1\xdf\x86'
    b">\x18\xd5|'\xe0\xdbk\x0f\x10\xcdi&\xb7}u}\xad\xeb&"
    b'\xc9\x98\xda\x8dN\xfe\xee[\xdb\xc5\xb6\xde\x03\xfd\x9c\\\\L"\x0f'
    b'\x97\x11\x84\x0cY\xb2\xc7\xa9\xa2\x8a(\xa2\x8a(\xaf=\xd0\xbe-\xea'
    b'\x9e9\xb1mk\xe1o\xc1\x8f\x88^2\xd1\xe3\xb8\x9e\xc6]B\x0b'
    b"K-!#\xbb\x82V\x8a{\x7f'X\xba\xb3\x9d\x9a7B\xac\xc9"
    b'\x13F\x1c2o\xdf\x1c\x88\x9b\x90\xe8\x7f\xb4\xd6\xb1\xb0\xdb|=\xf8'
    b'\x7f\xe1\xfbK\xdcyw\x1a\x9f\x8b.\xae\xef\xb4\xf8\xdf\xa3\xcfco'
    b'b!\x96h\xc1\xcb\xc1\x15\xf0\x8d\x99J-\xce\xd2%\xa9\xef?g'
    b'\xbf\x8a\xde0\xb0\xbc\xf0\xf7\xc4o\x8e\x1aG\xf6%\xed\xbc\x90\xcf\x0f'
    b'\x85\xfc\x11\x05\x9c\xf7*\xeb\xb1\xa1\x9c\xea\x97\x1a\x94\x12[\xb23\x86'
    b'\x8c@\xac\xc7g\xef\x02\x86G\xf6\x7f\t\xe8\x1f\xf0\x8axWF\xf0'
    b'\xb7\xf6\xde\xab\xac\xff\x00ci\xf6\xfa\x7f\xf6\x8e\xads\xf6\x8b\xeb\xcf'
    b'*5O>\xe2\\\x0f2g\xdb\xb9\xdf\x03s\x12p3_\x8d\x9f'
    b'\xf0Z\xbf\xf9:\x7f\x0b\x7f\xd9?\xb1\xff\x00\xd3\x8e\xa3_\xaa\x9f\xb2'
    b"w\xfc\x9a\xc7\xc1\xbf\xfb'\xfe\x1e\xff\x00\xd3t\x15\xea\xb4W\x0f\xf1"
    b'3\xe0\xc7\x80\xbe.\xcb\xa2M\xe3xu\xd9$\xf0\xe5\xc4\xd7zc'
    b'\xe9~$\xd4\xb4\x96\x82y"1<\xb9\xb2\x9e-\xcf\xe54\x88\x19'
    b'\xb2Ue\x95W\x02G\r\xc5\x7f\xc37x\x97\xfe\x8e\x87\xe2\xaf\xfe'
    b'\x01\xf8g\xff\x00\x94\xf5I\xfe\x14\xfe\xd2v\x88\xd7q\xfcU\xf8i'
    b'\xab< \xc8\xb6\r\xe0\x8b\xfd<]\x91\xc8\x84\xdd\x7fj\xdc}\x9f'
    b'~6\xf9\xbeD\xdb3\xbb\xca\x93\x1b\rG\xd2\xff\x00i\xdb4k'
    b'\xbb\xdf\x84\xdf\x0f\xae\xad\xe0\x06I\xa0\xd2\xbc}u-\xec\xa8\xbc\xb2'
    b'[\xa5\xc6\x95\x04/)\x00\x84Yg\x862\xc4\x06\x925\xcb\x8a\x9f'
    b'\xf0\x95|\\\xff\x00\xa3W\xf8\x93\xff\x00\x83O\x0c\x7f\xf2\xde\xaa\x7f'
    b'\xc2\xe9\xf0\xd7\xfd\t\x9f\x15\x7f\xf0\xd6x\x9b\xff\x00\x90*\x9f\xfc4'
    b'\xcf\xec\xdf\xff\x00G\x03\xf0\xdb\xff\x00\n\xbb\x0f\xfe;^\x93E\x14'
    b'W\x9fx\xef^O\x84S\xcf\xf1\x03C\xf8\xb3\xe0\xef\x87O\xae\xcf'
    b'\x1d\xa6\xa6\xfe-\x80M\xa4js\xacx\x8aC\x17\xda\xedJ\xde\xac'
    b'P\xec\x12\xa4\xc0\xbc)\xb2T\x94Cnm\xf9\x9b\x1f\xdb+\xc4\xd6'
    b'2\x1bM\x1f\xe2/\xc0\xef\x8b\xfa\x8d\xdf\xfc{\xe9^\x15\xbe\xbe\xb0'
    b'\xd4\xa3\xdb\x92\xdeU\x95\x97\xf6\xcd\xc5\xfeT\x97o.8\xbc\x94\x85'
    b'\xdd\xb7\xa9c\x17\xbb\xfc\x02\xf8\xab\xe3\x0f\x8b\x9e\x1a\xd65\xbf\x19\xfc'
    b'0\xbe\xf0E\xce\x9b\xac6\x9boor\xb7\xea\xb7\xd0\x0bky\x85'
    b'\xd4b\xfe\xca\xcap\x9b\xe7\x92\x1f\x9a\x007@\xf8f\x15\xe9\xd5\xf8'
    b'\xad\xff\x00\x05\xab\xff\x00\x93\xa7\xf0\xb7\xfd\x93\xfb\x1f\xfd8\xea5\xfa'
    b"\xa9\xfb'\x7f\xc9\xac|\x1b\xff\x00\xb2\x7f\xe1\xef\xfd7A^\xabU"
    b'5m[J\xd04\xab\xddw]\xd4\xed4\xed7N\xb7\x92\xee\xf2'
    b'\xf2\xeee\x86\x0bh#R\xd2K$\x8cB\xa2*\x82\xc5\x89\x00\x00'
    b'I\xaf3\x7f\xda\xc7\xf6b\xd8\xdfb\xfd\xa0~\x1fjw\x18>M'
    b'\x96\x95\xe2+[\xfb\xdb\xa7\xfe\x18\xad\xedm\xdd\xe6\xb8\x95\x8e\x15"'
    b'\x89\x1aGb\x15U\x98\x80j?\xedW\xf0\xceTh\xb4\x9f\x0f|'
    b'K\xd4o\x9c\x15\xb6\xb3_\x87:\xf5\xa1\xb9\x94\xfd\xc8\x84\xf7v\x91'
    b'[\xc3\xb9\xb0\xbed\xf2\xc7\x12\xe7.\xe8\xa0\xb0\xa6\xff\x00\xb4_\x8c'
    b'\xaeQ\xad\xf4\xcf\xd9\x93\xe2\x0c7\x92\x82\x96\xf2j\xba\xa7\x87\xe0\xb2'
    b'I\x0f\n\xd7\x12A\xa8\xcf4q\x03\x82\xed\x1c\x138\\\x95\x8eF'
    b'\x01\x0f\x99\xea\xdf\xb6\xde\xaba\x7f{\xe1\xbdW\\\xfd\x9d<5\xa9'
    b'[M%\x8d\xcc\xb7\x7f\x17\x1a\xee]2ub\x8e\xd2Y6\x9fn'
    b'\xd34l\t0\x19\xe0,T\xa1\x92<\xefZ\x90\xfe\xd0?\x1b\xbc'
    b'M\x18\xb4\xf0\x9f\xc4]+\xc5V\x9a\x8f\xfa=\xae\xa7\xe0o\x83z'
    b'\xcd\xd47L\xdf!\x16Z\xc4\xba\x84\xfaBJ\xaf\x94\xf3\xae\x19\xed'
    b'\xe1\x95O\x9e6\xc7"\x8b\x11xS\xf6\xcd\xf1ZIkg\xaf\xfc'
    b'E\xb1\xb1\x03\xcb\xbf\xb5\xf1\xa7\x89|-\xa2\x9b\xd8\x9f\x83\x1d\xb5\xc6'
    b"\x81\xa5\xde\xdc'\xca\x18<\x82[Yc\xdd\x1bB\xe5\xb2\xd1\xebh"
    b'?\xb1V\xa5\xe2\x19\x9e_\x8c\xff\x00\x19<u\xa9h\xb7v\xd3A'
    b's\xe0\xfd\x1f\xc7>#\xfe\xcd\xb9\x86\xe2\x17I\xad/\xee.\xf5\t'
    b'e\xbeD\x0c\xa1\x1e\x14\xb1\x0f\xb5\xcc\xb12\xb8\x8a>\x87\xc1\xbf\xb0'
    b"'\xec\xb7\xf0\xeb\xed\x9f\xf0\xaf\xbc\x1b\xe2_\x0c\x7fhy\x7fk\xfe"
    b'\xc6\xf1\xe7\x88,\xbe\xd1\xe5\xee\xd9\xe6yW\xab\xbfn\xf7\xc6s\x8d'
    b"\xcd\x8e\xa6\xba_\xf8e\x1f\x84\x7f\xf3\xff\x00\xf1'\xff\x00\x0e\x97\x89"
    b'\xff\x00\xf9aJ\x9f\xb2\x87\xc1\xad\xeb\xf6\xd8|m\xa9\xdb\xe4y\xd6'
    b"Z\xaf\xc4\x1f\x10_\xd9]'\xf1Eqkqz\xf0\xdcD\xc3*"
    b'\xf1J\x8d\x1b\xa9*\xca\xcaH6\xff\x00\xe1\x93\xbfe\x8f\xfa6\x9f'
    b'\x85_\xf8F\xe9\xdf\xfcf\xba\x0f\x05|\x10\xf8/\xf0\xd7U\x97]'
    b'\xf8s\xf0\x87\xc1^\x15\xd4\xa7\xb7kIo4M\x02\xd2\xc6y '
    b'fVh\x9aHcV(Y\x11\x8a\x93\x8c\xa2\x9e\xc2\xbbZ(\xaf'
    b'\xc5o\xf8-_\xfc\x9d?\x85\xbf\xec\x9f\xd8\xff\x00\xe9\xc7Q\xaf\xd5'
    b'O\xd9;\xfeMc\xe0\xdf\xfd\x93\xff\x00\x0f\x7f\xe9\xba\n\xf5Z\xf3'
    b"?\x1f\xfe\xcd\x1f\x00\xfe'jW\x1a\xff\x00\x8c\xfe\x13\xf8z\xeb_"
    b'\xba\x9e\xd6\xe9\xfcAkj,\xb5\xa5\x9a\xd9\xa3h$\x8fQ\xb7\xd9'
    b'w\x1b\xa7\x93\x18\x0c\x92\x83\xb5B\xfd\xdc\x8a\xca\xff\x00\x86Q\xf8G'
    b'\xff\x00?\xff\x00\x12\x7f\xf0\xe9x\x9f\xff\x00\x96\x15f\x1f\xd9?\xf6'
    b'k1\x83\xac|\x12\xf0\x97\x88\xef?\xe5\xa6\xa7\xe2m95\xcdJ'
    b'\x7fO:\xfa\xfb\xce\xb9\x9bh\xc2\xaf\x99#mED\\*\xaa\x87'
    b"\xff\x00\xc3'~\xcb\x1f\xf4m?\n\xbf\xf0\x8d\xd3\xbf\xf8\xcdzV"
    b'\x93\xa4\xe9Z\x06\x95e\xa1hZe\xa6\x9d\xa6\xe9\xd6\xf1\xdaY\xd9'
    b'\xdaB\xb0\xc1m\x04j\x168\xa3\x8d@TEP\x14(\x00\x00\x00'
    b"\x15n\x8a(\xa2\x8a(\xa2\x8a+\xf1[\xfe\x0bW\xff\x00'O\xe1"
    b"o\xfb'\xf6?\xfaq\xd4k\xe0\n(\xa2\x8a(\xa2\x8a(\xa2\x8a"
    b'(\xa2\x8a(\xaf\xff\xd9'
)

# ===== MAIN =====
display = PicoGraphics(display=DISPLAY_INKY_PACK)

try:
    display.set_pen(WHITE); display.clear()
    display.set_pen(BLACK); display.set_font("bitmap8")
    display.text("Connecting...", 10, 55, scale=1)
    display.update()

    if not connect_wifi():
        show_error(display, "WiFi failed"); raise SystemExit

    lat, lon, city = get_location()
    data     = get_weather(lat, lon)
    cw       = data["current_weather"]
    daily    = data["daily"]

    temp     = int(cw["temperature"])
    desc     = WMO.get(int(cw["weathercode"]), "?")
    hmax     = int(daily["temperature_2m_max"][0])
    hmin     = int(daily["temperature_2m_min"][0])
    tmax     = int(daily["temperature_2m_max"][1])
    tmin     = int(daily["temperature_2m_min"][1])
    tmr_desc = WMO.get(int(daily["weathercode"][1]), "?")
    date_str = parse_time(cw.get("time", ""))
    gc.collect()

    # --- DRAW ---
    display.set_pen(WHITE); display.clear()

    # 1. UK map from embedded bytes
    j = jpegdec.JPEG(display)
    j.open_RAM(UK_MAP)
    j.decode(MAP_X, MAP_Y)

    # 2. Mask left panel
    display.set_pen(WHITE); display.rectangle(0, 0, MAP_X, 128)

    # 3. Header
    display.set_pen(BLACK); display.rectangle(0, 0, 296, 14)
    display.set_pen(WHITE); display.set_font("bitmap6")
    display.text(city[:14], 3, 4, scale=1)
    display.text(date_str, 200, 4, scale=1)

    # 4. Left: today
    display.set_pen(BLACK); display.set_font("bitmap8")
    display.text("{}C".format(temp), 4, 18, scale=3)
    display.set_font("bitmap6")
    display.text(desc, 4, 58, scale=1)
    display.text("H:{}  L:{}".format(hmax, hmin), 4, 70, scale=1)

    # 5. Left: tomorrow
    display.set_pen(BLACK); display.line(4, 84, 143, 84)
    display.set_font("bitmap8"); display.text("Tmr", 4, 90, scale=1)
    display.set_font("bitmap6")
    display.text(tmr_desc, 4, 104, scale=1)
    display.text("H:{}  L:{}".format(tmax, tmin), 4, 115, scale=1)

    # 6. Divider
    display.set_pen(BLACK); display.line(148, 14, 148, 127)

    # 7. Location dot (lookup table first, fallback to math)
    if city in CITY_DOTS:
        dx, dy = CITY_DOTS[city]
    else:
        dx, dy = latlon_to_dot(lat, lon)
    display.set_pen(BLACK); display.circle(dx, dy, 5)
    display.set_pen(WHITE); display.circle(dx, dy, 2)
    display.set_pen(BLACK)

    # 8. Bottom border + push
    display.line(0, 127, 295, 127)
    display.update()

except Exception as e:
    try:
        show_error(display, e)
    except Exception:
        pass
    raise
